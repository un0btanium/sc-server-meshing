# Persistent Entity Streaming
### Challenges:
* With the vision of eventually all items physically present and stored in the game world, with physicalized damage and degradation, with thousands of NPCs going about their lifes, with thousands of dynamic missions and events generated by AI and players, with a fully simulated economy, all in a potential single-shard server mesh, all the game information needs to be persisted into databases and then accessed by and networked between the game servers and clients in real-time, requiring an architecture that is able to handle high amounts of data.

__Solution:__ Persistent Entity Streaming (or Persistent Streaming or just PES), complete Interest Management with Full Persistence

__Requirement for:__ Server Meshing, Full Persistence

__Goals:__

* Have a persistent world where everything is stored into databases and loaded (streamed-in) by the game servers, clients and various other services that need that data.
* Allow for all items to be placed anywhere in the game world, persist over large amounts of time and be visited and retrieved later.
* Split State Persistence and State Replication from the Game Simulation by moving that logic out of the game servers and into services.

__Approach:__

* Introduce a highly scalable, cloud-native service backend architecture for high data throughput, low latency, high responsiveness, fault tolerance and crash recovery.
* Besides new logic, this requires a lot of existing logic to be moved out of the game server and into their own services/servers.
* Introduce:
* Two databases: EntityGraph database & Global Database.
* "EntityGraph service": Allows other services to accesses the data of those two databases or move data between the two.
* Replication Layer service: Handles communication between game servers and clients with a cache to store and network the entity state.
* StarSim Economy Simulator: Simulates the economy in a high-level abstraction environment to create a realistic action-reaction system.
* The game server is just left with simulating the game, streaming in all necessary data in and out.
* Uses gRPC (Remote Procedure Calls) for communication between services and game servers (speculated: does not use only RPC).
* The initial persistence solution was attempted with a relational database, which, after internal testing, didnt live up to performance and latency requirements. So, a switch to a graph database and the Replication Layer service commenced end of 2020/early 2021.
* A first version comes online with the Replication Layer and EntityGraph in Alpha 3.18.
* Moving the Replication Layer out of the game server and onto its own server is the next step toward Server Meshing.
